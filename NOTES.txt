Список фиксов:
-токен модель не позволяет иметь несколько авторизованных браузеров: (ПОКА ПОФИГ)
-НА БУДУЩЕЕ СДЕЛАТЬ ТАК ЧТОБЫ НЕ ОТОБРАЖАЛАСЬ СТРАНИЦЕ ПОКА НЕ ЗАГРУЖЕНЫ ДАННЫЕ
-Фильтры работают, но размер иконок меняется мб пофиксить(не горит, но хочу исправить)
-если перезагрузить страницу с песней то песня не будет играть
-на странице библиотеки если нажать на три точки то почему то будет сверху лоудер страницы
-Если я открытваю попап который fixed то нужно блокировать скролл. Например, на странице плейлиста или библиотеки
- real time chat(не уверен смогу ли сделать это в next)
- Голосовое сообщение (сделал, но без дизайна плеера аудио)
- build не работает
- Если удалить последнее сообщение то lastmessage не обновиться

Заметки:
-Удаление аккаунта работает, но надо потом как то убирать его id из других схем
- Лоудинг когда аудио файл подгружается

- Передизайнить плеер (цвета, и может как-то изменить картинку трека) (ПОД НАСТРОЙКИ ПОЛЬЗОВАТЕЛЯ В ПРОФИЛЕ!!!!!)
- ПОДЗАПАРИТЬСЯ С ДИЗАЙНОМ ДОБАВИТЬ КРАСОТЫ!!!!!!!!!!!!!!!!!!!!!!

Делаю 16.05.2025
- сделать добавление юзера в друзья через уведомление (ищу пользователя, перехожу на профиль, (либо добавляю в 
друзья либо просто создается чат, ели что его можно заблочить(Блокировка юзера),
 пользователь может ограничить сообщения со стороны)) (по сути только блокировка осталась)

Это мб на 17 число:
- сделать комменты для постов и лайки.

- Отобразить топ посты по лайкам в мейн пейдж и музыку
- Отображать то, что слушают пользователи на мейн страницы и что они лайкают, мероприятия и посты!!!!!
- в обзоре отобразить историю прослушиваний (история на 1 юзера хранит 10 треков), лучшие посты, популярные треки
На странице профиля обзор размести что лайкал пользователь и мб его последние комментарии
- Еще раз просмотреть дизайн, убрать то что не реализовано и не нужно(например опции у плеера и лупа в хедере)
- Адапативность и деплой (билдить вроде не надо, netlify)
- thats all




Аномалии:
-В стрикт моде в странице с верификацией email фукнция срабатывает 2 раза в useEffect

СЕЙЧАС Я ОТКЛЮЧИЛ СТРИКТ МОД - РЕАКТ МОЖЕТ НЕ ОТЛАВЛИВАТЬ НЕКОТОРЫЕ ОШИБКИ


async function getPosts(req, res) {
  const userId = req.user._id;

  // Получаем посты и попутно вытаскиваем реакции
  const posts = await Post.find()
    .populate({
      path: 'author',
      select: 'username avatar'
    })
    .lean();

  // Готовим массив ID постов
  const postIds = posts.map(p => p._id);

  // Получаем реакции разом, массово фильтруя по ID постов и текущему пользователю
  const reactions = await Reaction.find({
    userId: userId,
    targetId: { $in: postIds },
    targetType: 'Post'
  });

  // Связываем реакции с соответствующими постами
  posts.forEach(post => {
    const postReaction = reactions.find(r => r.targetId.equals(post._id));
    if (postReaction) {
      post.liked = postReaction.reactionType === 'like';
      post.disliked = postReaction.reactionType === 'dislike';
    } else {
      post.liked = false;
      post.disliked = false;
    }
  });

  res.json(posts);
}